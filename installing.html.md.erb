---
title: Installing and Configuring Compliance Scanner for PCF
owner: Pivotal Compliance and Innovation (PCI) Team
---
<strong><%= modified_date %></strong>

This topic describes how to install and configure <%= vars.product_full %>.

## <a id='prerequisite'></a> Prerequisite

<%= vars.product_short %> runs a scanner daemon on each VM that requires ~100&nbsp;MB of memory.
Before you install <%= vars.product_full %>, you might need to resize your VMs accordingly.

## <a id='install'></a> Install <%= vars.product_short %>
To install the <%= vars.product_short %> file on the Ops Manager Installation Dashboard:

1. Download the product file from [Pivotal Network](https://network.pivotal.io/products/compliance/).

1. Navigate to the Ops Manager Installation Dashboard and click **Import a Product** to upload the product file.

1. Under the **Import a Product** button, click **+** next to the version number of <%= vars.product_short %>.
This adds the tile to your staging area.

1. Click the newly added **<%= vars.product_short %>** tile.

## <a id='scan'></a> Configure Scans
This section is where you configure expected values for tests and select which set of benchmarks to run. To configure your scans:

1. Click **Settings**.

    <%= image_tag("compliance-settings.png", :alt => "Compliance Settings page") %>

1. Click **Assign AZs and Networks**.

1. Configure the fields as follows:

    <table class="nice">
      <th>Field</th>
      <th>Description</th>
      <tr>
        <td><strong>Place singleton jobs in</strong></td>
        <td>Select the AZ that you want the <code>oscap_store</code> VM to run in.<br>
          The tile runs as a singleton job.</td>
      </tr>
      <tr>
        <td><strong>Balance other jobs in</strong></td>
        <td>Select the same AZ as above.</td>
      </tr>
      <tr>
        <td><strong>Network</strong></td>
        <td>Select a subnet for the <code>oscap_store</code> VM. <br>This is typically the same subnet that
          includes the Pivotal Application Services (PAS) component VMs.</td>
      </tr>
    </table>

1. Click **Save**.

1. Click **System Variables**.

    <%= image_tag("system-var.png", :alt => "System Variables page", :width => "260") %>

1. Configure the fields in **System Variables** to provide the expected values for the tests:

    <table class="nice">
        <th>Field</th>
        <th>Description</th>
        <tr><td><strong>NTP Server IP</strong></td>
                <td>The IP address of your NTP server.<br> <br>You can find this IP address in
                  <strong>Bosh Director</strong> > <strong>Director Config</strong> >
                  <strong>NTP Server</strong>. You can only enter one server IP address. It does not
                  matter which NTP server you enter.
                </td>
        </tr>
        <tr><td><strong>Syslog Host IP</strong></td>
                <td>The IP address of your syslog host.<br><br>
                    You can find this in your PAS tile under
                    <strong>Settings > System Logging > Address</strong>.</td>
        </tr>
        <tr><td><strong>Syslog Port</strong></td>
                <td>The port number of the syslog port.<br><br>
                    You can find this in your PAS tile under
                    <strong>Settings > System Logging > Port</strong>.</td>
        </tr>
    </table>

1. Click **Save**.

1. Click **Scan Configuration**.

    <%= image_tag("scan-config.png", :alt => "Scan Configuration page", :width => "400") %>

1. Enable **Scan Report Formats**. You must select at least one format.
   The outputs of a scan can be in CSV, XML, and HTML formats.

1. Enable **Benchmarks** for the scanner to run:

    <table class="nice">
        <th>Benchmark</th>
        <th>Description</th>
        <tr><td><strong>Base Xenial</strong></td>
                <td>Includes a subset of the amended tests in the STIG benchmark,
                    where failing tests due to architectural differences are removed.<br>
                This is meant to be used as a measure to see if configurations have been altered.<br></td>
        </tr>
    	<tr><td><strong>Recommended Security Baseline</strong></td>
                <td>A benchmark with rules that all systems should implement, regardless of user
                  environment or the sensitivity of the app data being processed.</td>
        </tr>
        <tr><td><strong>Strict Security Practices</strong></td>
                <td>A benchmark with strict rules that are required of systems processing sensitive
                  data or workloads. This is meant to run in addition to the tests in the recommended
                  security baseline benchmark.</td>
        </tr>
        <tr><td><strong>STIG for Ubuntu Xenial</strong></td>
                <td>Includes all the configuration tests of the published DISA STIG
                  for Ubuntu 16.04, amended with stemcell specific changes. Contains tests that would
                  fail due to architectural differences.</td>
    </table>
    <br><br>
    A scan report is generated for each format and benchmark on each Linux VM running on Xenial stemcells.
    For example, if you select **.xml** and **.csv** formats,
    and **Base Xenial** and **STIG** benchmarks, four CSV files are created for each VM tested.
    <br><br>
    For more information about <%= vars.product_short %> benchmarks, see [Benchmarks](./benchmarks.html).

1. For **Scanner Timeout**, configure the maximum time in seconds permitted for a scan.
    The default value is `1200`.

1. For **Enforce CPU limit**, configure the CPU limit percentage (between `1` and `100`)
  that the Scanner is allowed to use.
  The default value is `Disable`.

    <p class="note"><strong>Note:</strong>
      <strong>Enforce CPU limit</strong> affects only 1 core. For example:
       In a system with four cores with a CPU limit set to <code>100</code>,
       the scanner only uses one of the four cores.
      </p>

1. Click **Save**.


## <a id="errands"></a> Configure Errands
<%= vars.product_short %> performs one errand that initiates scanning.
This errand is disabled by default.
This is so that a scan is not run every time changes are applied.

When this errand is triggered, it initiates the scanning errand on each VM.
For more information about initiating the scanning errand, see [Using <%= vars.product_short %>](./using.html).

When configuring the <%= vars.product_short %> tile for the first time:

1. Click **Errands**.

    <%= image_tag("errands.png", :alt => "Errands page") %>

1. Confirm that **Run configured scans** is set to **Default (Off)**.

1. Click **Save**.

## <a id="s3"></a> (Optional) Configure S3 Upload
To store scan results in an Amazon S3 bucket or a Minio S3-compatible bucket,
configure an S3 upload.

If you configure an S3 bucket, then <%= vars.product_short %> uploads scan
results to the S3 bucket.
This means that auditors do not need access to Ops Manager to download BOSH logs
or rely on the operator to give them scan results.
Additionally, when using a Security Information and Event Management (SIEM) system,
automating the consumption of the scan results is easier and does not require
access to the Ops Manager API.

If you do not use an S3 bucket for scan results, then the scan results are stored in the `oscap_store` VM.
For more information, see [Retrieve Log Files](./using.html#review-tile).

1. Click **S3 Upload**

1. To use an S3 bucket:
  1. Select **AWS S3 Bucket**.

        <%= image_tag("bucket-aws.png", :alt => "AWS S3.", :width => "300") %>

  1. Configure the fields as follows:

        <table class="nice">
          <th>Field</th>
          <th>Description</th>
          <tr>
            <td><strong>Bucket Name</strong></td>
            <td>Enter the name of the bucket.</td>
          </tr>
          <tr>
            <td><strong>Bucket Region</strong></td>
            <td>Select the region that the bucket was created in.</td>
          </tr>
          <tr>
            <td><strong>Access Key ID</strong></td>
            <td>Enter the access key ID for AWS credentials with access to the bucket. <br>
              Pivotal recommends that you ensure the credentials permit write access to just this bucket.</td>
          </tr>
          <tr>
            <td><strong>Secret Access Key</strong></td>
            <td>Enter the access key secret for AWS credentials with access to the bucket. <br>
              Pivotal recommends that you ensure the credentials permit write access to just this bucket.</td>
          </tr>
        </table>

1. To use a Minio bucket:

  1. Select **Minio Bucket**.

        <%= image_tag("bucket-minio.png", :alt => "Minio Object Storage.", :width => "300") %>

  1. Configure the fields as follows:

        <table class="nice">
          <th>Field</th>
          <th>Description</th>
          <tr>
            <td><strong>Bucket Name</strong></td>
            <td>Enter the name of the bucket.</td>
          </tr>
          <tr>
            <td><strong>Minio Host</strong></td>
            <td>Enter the fully qualified domain name of the Minio server.
              This can include a port, but should not specify the protocol. <br>
              For instance, <code>example.domain.com:9000</code> is a valid host.</td>
          </tr>
          <tr>
            <td><strong>Bucket Region</strong></td>
            <td>If your Minio configuration specifies a region, enter that region here. <br>
              Otherwise, this field can be left blank.</td>
          </tr>
          <tr>
            <td><strong>Access Key ID</strong></td>
            <td>Enter the access key ID for the Minio server.</td>
          </tr>
          <tr>
            <td><strong>Secret Access Key</strong></td>
            <td>Enter the access key secret for the Minio server.</td>
          </tr>
          <tr>
            <td><strong>Bucket CA Certificate</strong></td>
            <td>Enter the CA Certificate used by the Minio server, if applicable.
              If the Minio server does not use TLS, leave this field blank. <br><br>
              If the Minio server is a PAS service instance, this CA Certificate must match the
              <strong>SAML Service Provider Credentials</strong> field under the <strong>UAA</strong> form in your PAS tile.</td>
          </tr>
        </table>

1. Click **Save**.

## <a id="syslog"></a> Configure System Forwarding

To configure system forwarding:

1. Select **Syslog**.
  ![Syslog](syslog.png)

1. Select **Yes** for **Do you want to configure Syslog forwarding?**.
1. Configure the fields as follows:
    <table>
      <tr>
        <th>Field</th>
        <th>Instructions</th>
      </tr>
      
      <tr>
        <td><strong>Address</strong></td>
        <td>Enter the address or host of the syslog server for sending logs, for example,
        <code>logmanager.example.com</code>.</td>
      </tr>
              
      <tr>
        <td><strong>Port</strong></td>
        <td>Enter the port of the syslog server for sending logs, for example, <code>29279</code>.</td>
      </tr>
        
      <tr> 
        <td><strong>Transport Protocol</strong></td>
        <td>Select the transport protocol used to send system logs to the server. 
        Pivotal recommends TCP.</td>
      </tr>
          
      <tr>
        <td><strong>Enable TLS</strong></td>
        <td>If you select TCP, you can also select to send logs encrypted over TLS.</td>
      </tr>
      
      <tr>
        <td><strong>Permitted Peer</strong></td>
        <td>Enter either the accepted fingerprint, in SHA1, or the name of the remote peer, 
        for example, <code>*.example.com</code>.</td>
      </tr>
          
      <tr>
        <td><strong>SSL Certificate</strong></td>
        <td>Enter the SSL or TLS Certificate(s) for the syslog server. 
        This ensures the logs are transported securely.</td>
      </tr>
      
      <tr>
        <td><strong>Queue Size</strong></td>
        <td>Enter an integer. This value specifies the number of log messages held in the buffer.
        The default value is <code>100000</code>.</td>
      </tr>
      
      <tr>
        <td><strong>Forward Debug Logs</strong></td>
        <td>Select this box to forward debug logs to external source.
        This option is deselected by default. 
        If you select it, you might generate a large amount of log data.</td>
      </tr>
      
      <tr>
        <td><strong>Custom rsyslog Configuration</strong></td>
        <td>Enter configuration details for rsyslog. This field requires RainerScript syntax.</td>
      </tr>
      
    </table>
  
1. Click **Save Syslog Settings**.



## <a id="resources"></a> Configure Resources
The tile creates a new VM called `oscap_store` to store the logs retrieved from all the other VMs
that have been scanned.

<p class="note"><strong>Note:</strong>
The <code>oscap_store</code> VM does not do anything computationally extensive.
Pivotal recommends using the default configurations.</p>

1. Click **Resource Config**.

1. Click **Save**.

## <a id="apply-changes"></a> Apply Changes from Your Configuration
Your installation is not complete until you apply your configuration changes:

1. Return to the Ops Manager Installation Dashboard.

1. Click **Review Pending Changes**. Verify that all products are selected.

1. Click **Apply Changes** to complete the installation of <%= vars.product_short %>.
